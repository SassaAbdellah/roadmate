{% extends "templates/base.html" %}


<!--calendar scripts import library start-->
{% block javascript %} 
<script src="http://www.google.com/jsapi?key=ABQIAAAAh9vEamNAbo2MjViKEXyTSBQtrj2yXU7uUDf9MLK2OBnE3PD31hQrtHqCrQiA2FONyyl-gzfE04lUdA" 
type="text/javascript"></script>

<script type="text/javascript" src="scripts/google-calendar/jquery-1.1.4.pack.js"></script>

<script src="scripts/google-calendar/cal_Auth.js"></script>
{% endblock %}


<!--calendar scripts end-->






{% block title%}View Ride{% endblock %}

{% block main %}

<!--this img for calendar scripts loading purpose, do not remove-->
<img src="images/rss.gif" style="position:absolute; top: -1000px;" />

	<h2>view ride</h2>
	<h3>{{ ride.get_name }}</h3>
	
	<p> <!-- ride details -->
		<strong>Date</strong> {{ ride.date }}<br />
		<strong>Departs from </strong><a href="/location?id={{ ride.source.key.id }}">{{ ride.source.get_addressname }}</a><strong> at </strong>{{ ride.departure_time }} <br />
		<strong>Arrives at </strong><a href="/location?id={{ ride.destination.key.id }}">{{ ride.destination.get_addressname }}</a><strong> at </strong> {{ ride.arrival_time }}<br />
		<strong>Seats </strong> {{ride.count_seats}} <br />
		<p />
		<strong>Driver</strong> <a href="/profile?user={{ ride.owner.key.id }}">{{ ride.owner.user.email }}</a><br />
		<p />
		{% if ride.notes %}
			<strong>Notes</strong> {{ ride.notes }}<br />
		{% endif %}
		<p />
		
		
		<!-- calendar scripts begin-->
				<!--hidden field use to insert into calendar-->	
			<input  id="from" type="hidden" value="{{ ride.source.get_addressname }}" />
			<input  id="to" type="hidden" value="{{ ride.destination.get_addressname }}" />
			<input  id="startTime" type="hidden" value="{{ ride.date }}T{{ ride.departure_time }}.00Z" />
			<input  id="endTime" type="hidden" value="{{ ride.date }}T{{ ride.arrival_time }}.00Z" />
			
			 <input  id="ride_id" type="hidden" value="{{ride.key.id }}" />
			 <input id="calendar_id" type="hidden" value="" />
		<br/>
		<br/> 
		<br/> 
	   <form id="log_in" >
		         <!--if no google calendar Token show following field-->
			<strong>Create a google calendar reminder:</strong>&nbsp;&nbsp;&nbsp;<a href="#" onClick=" logMeIn(); return false;" > grant access</a>
		</form>
					
				<!--if has google calendar Token show following field-->	
		<form id="add_event"  name="remindForm"  >
		          <strong>Create a google calendar reminder:</strong><br/><br/>
		         <input id="byEmail" class="checkbox" type="checkbox" name="reminder" value="email" >Email&nbsp;&nbsp;&nbsp;
                 <input id="bySms" class="checkbox" type="checkbox" name="reminder" value="sms" >SMS &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				 <select id="remindTime">
	                  <option>1</option>
	                  <option>2</option>
	                  <option>3</option>
	                  <option>4</option>
	                  <option>5</option>
	                  <option>6</option>
	                  <option>7</option>
	                  <option>8</option>
	                  <option>9</option>
					  <option>10</option>
					  <option>11</option>
	                  <option>12</option>
	                  <option>13</option>
	                  <option>14</option>
	                  <option>15</option>
	                  <option>16</option>
	                   <option>17</option>
	                  <option>18</option>
	                  <option>19</option>
					  <option>20</option>
					   <option>21</option>
	                  <option>22</option>
	                  <option>23</option>
                  </select>
				 <select id="timeBase">
                   <option>minutes</option>
                   <option>hours</option>
                   <option>days</option>
                 </select> 
				
				 &nbsp;&nbsp;&nbsp; before ride
                
                
                 <br/>
				 <br/>
  <span id="addcalendar">
      <input id="create" class="button" type="button" value="Create" onClick="insertEvents(); setTimeout('showRemoveBt()', 3000); return false; "/>
  
  </span>
  
	<!--use for debug  <a href="#" onClick=" logMeOut();return false;"></a>-->
		</form>
		
		<br/>
		<br/>
		<br/>
			
	  <!--calendar scripts end-->

		
		
		
		

		


		<form method="post">
			<h3>{{ride.count_emptyseats }} seat{% ifnotequal ride.count_emptyseats 1 %}s{% endifnotequal %} available
			{% if ride.count_emptyseats %}<!-- show the request button-->
				<input type="hidden" name="do_request_ride" value="True"/>
				<input class="button"  value="Request a Seat" type="submit"></h3>
			{% else %}
		        </h3>
			{% endif %}
			{% if not requestable %} <!-- show the instruction-->
				<strong>
					Your request for a seat on this ride has been recorded
					and you will be notified when it is approved
				</strong>
			{% endif %}
		</form>

	</p>
	
{% if has_passengers %}<!-- show passengers -->
<p>
<hr />
<table>
	<h2>passengers</h2>
	<tr>
	<th>User</th>
	<th>Date Accepted</th>
	</tr>
	{% for seat in ride.seats %}
	  {% if seat.passenger %}
			<tr class="row-a">
				<td>
					<a href="/profile?id={{ seat.passenger.user.key.id }}">{{seat.passenger.user.email}}</a></td>
				</td>
				<td>
					{{seat.accepted}}
				</td>
			{% ifequal current_user ride.owner %} <!-- only show "assign seat" if user is owner -->
				<td>
					 <a href="/ride?id={{ride.key.id}}&amp;seat_id={{seat.key.id}}&amp;action=RM">Remove User</a></td> <!--TODO-->
				</td>
				<td>
					 <a href="/ride?id={{ride.key.id}}&amp;seat_id={{seat.key.id}}&amp;action=DEL">Delete Seat</a></td> <!--TODO-->
				</td>
			{% endifequal %}
		  	</tr>
	  {% endif %}
	{% endfor %}
</table>
</p>
<!-- end if - show passengers -->
{% endif %}


{% ifequal current_user ride.owner %}{% if ride.passengerrequests.count %} <!-- show passenger requests -->
<hr />
	<p>
	<table>
	<h2>passenger requests</h2>
      	<tr>
		<th>User</th>
        <th>Date</th>
		</tr>

      	{% for prq in ride.passengerrequests %}
			<tr class="row-a">

			<td>
				 <a href="/profile?id={{ prq.owner.key.id }}">{{prq.owner.user.email}}</a></td>
			</td>
			{% ifequal current_user ride.owner %} <!-- only show "assign seat" if user is owner -->
				<td>
					 <a href="/ride?id={{ride.key.id}}&amp;prq_id={{prq.key.id}}&amp;action=APRV">Approve Request</a></td>
				</td>
			{% endifequal %}
		  </tr>
		{% endfor %}
		</table>

	</p>
	<!-- end if show passenger requests -->
	{% endif %}
{% endifequal %}

{% if lat_lng_src and lat_lng_des %}
	<p> <!-- Static Google Map -->
	<noscript>
		<h2>map</h2>
		<img src="http://maps.google.com/staticmap?&amp;size=400x400&amp;markers={{lat_lng_src}},reds%7C{{lat_lng_des}},blued&amp;key={{ googlemaps_key }}"/>
	</noscript>
	</p>
    <html xmlns="http://www.w3.org/1999/xhtml">
      <head>
      <!-- Javascript Map Version -->
        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
        <title>Google Maps JavaScript API Example</title>
        <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ googlemaps_key }}"
                type="text/javascript"></script>
        <script type="text/javascript">
     // JavaScript Document
        var bounds = new GLatLngBounds();
        var map;
        var directionsPanel;
        var directions;
        function initialize() {
            var map = new GMap2(document.getElementById("map_canvas"));
            map.setCenter(new GLatLng({{lat_lng_src}}), 13);

            var topRight = new GControlPosition(G_ANCHOR_TOP_RIGHT, new GSize(10,10));
            var bottomRight = new GControlPosition(G_ANCHOR_BOTTOM_RIGHT, new GSize(10,10));
            map.addControl(new GSmallMapControl());

            var source = new GMarker(new GLatLng({{lat_lng_src}}));
            map.addOverlay(source);
            bounds.extend(source.getPoint());

            var destination = new GMarker(new GLatLng({{lat_lng_des}}));
            map.addOverlay(destination);
            bounds.extend(destination.getPoint());

          //Shows the route between destination and source
            directionsPanel = document.getElementById("route");
            directions = new GDirections(map, directionsPanel);
            directions.load("from: {{ ride.source.address }} to: {{ ride.destination.address }}");

            map.setZoom(map.getBoundsZoomLevel(bounds));
            map.setCenter(bounds.getCenter());

        }
        </script>
      </head>
      <body onLoad="initialize()" onUnload="GUnload()">
        <div id="map_canvas" style="width: 400px; height: 400px"></div>
      </body>
    </html>

{% endif %}

<p /><hr />



{% if message_list%}  <!-- messages -->
<p />
<table class="messages">
	{% for message in message_list %}
       <tr class="message-{{ message.style }}"> <td>
        <strong>{{message.title}}</strong><br/>
		<a href="/profile?id={{ message.author.key.id }}">{{message.author.user.email}}</a>{% ifequal message.style "user" %} {% else %} ({{ message.style }}) {% endifequal %}<br/>
    </td></tr>
    <tr class="message-text" ><td>
    {{message.text}}
    </td></tr>
    <tr class="message-space"></tr>
	{% endfor %}
</table>

{% endif %}

<form method="post"> <!-- message form -->
	<div class="inputgroup">
		 <div>
	        <strong>Title </strong><input type="text" name="message_title" />
	      </div>

			<div>
			<strong>Type your message here</strong>
			<textarea name="message_body"></textarea>

			<input type="hidden" name="do_post_message" value="True"/>
			<input class="button" value="Submit" type="submit"/>
		</div>
	</div>
</form>

</p>


<p /><hr />
<p />
{% endblock %}
