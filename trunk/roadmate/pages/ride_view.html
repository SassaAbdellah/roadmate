{% extends "templates/base.html" %}

{% block title%}View Ride{% endblock %}

{% block main %}
	<h2>View Ride</h2>
	<p> <!-- ride --!>
			<strong>Owner</strong> <a href="/profile?user={{ ride.owner.key.id }}">{{ ride.rideoffer.owner.user.email }}</a><br />
			<strong>From</strong> <a href="/location?id={{ ride.rideoffer.source.key.id }}">{{ ride.rideoffer.source.name }}</a>
			<strong>To</strong> <a href="/location?id={{ ride.rideoffer.destination.key.id }}">{{ ride.rideoffer.destination.name }}</a><br />
			<p />
			<td><strong>Date</strong> {{ ride.date }}<br />
			<strong>Departs at</strong> {{ ride.departure_time }} <strong> Arrives at</strong> {{ ride.arrival_time }}</td>


			{% if ride.notes %}
				<strong>Notes</strong> {{ rideoffer.notes }}<br />
			{% endif %}
			<p />


			{% if requestable %}<!-- show the request button-->
				<form method="post">
				<input type="hidden" name="do_request_ride" value="True">
				<input class="button"  value="Request a Seat" type="submit">
				</form>
			{% else %} <!-- show the instruction-->
				<code><strong>
				   Your request for a seat on this ride has been sent
				   and you will be notified when it is approved
				</strong></code>

			{% endif %}



	</p>

	<h3>{{ride.count_seats}} seat{% ifnotequal ride.count_seats 1 %}s{% endifnotequal %}, {{ride.count_emptyseats}} not assigned</h3>


	<p> <!-- show passengers = assigned seats --!>

  <table>
  	<h3>Passengers</h3>
  	<tr>
	<th>User</th>
    <th>Date</th>
	</tr>
  	{% for seat in ride.seats %}
  	  {% if seat.passenger %}
			<tr class="row-a">
				<td>
					<a href="/profile?id={{ seat.passenger.user.key.id }}">{{seat.passenger.user.email}}</a></td>
				</td>
				<td>
					{{seat.accepted}}
				</td>
			{% ifequal current_user ride.rideoffer.owner %} <!-- only show "assign seat" if user is owner --!>
				<td>
					 <a href="/ride?id={{ride.key.id}}&seat_id={{seat.key.id}}&action=RM">Remove User</a></td> <!--TODO-->
				</td>
				<td>
					 <a href="/ride?id={{ride.key.id}}&seat_id={{seat.key.id}}&action=DEL">Delete Seat</a></td> <!--TODO-->
				</td>
			{% endifequal %}
		  	</tr>
	  {% endif %}
	{% endfor %}
	</table>

	</p>

	{% ifequal current_user ride.rideoffer.owner %}
	<p> <!-- show passenger requests --!>

	<table>
	<h3>Open Passenger Requests for this Ride</h3>
      	<tr>
		<th>User</th>
        <th>Date</th>
		</tr>

      	{% for prq in ride.passengerrequests %}
			<tr class="row-a">

			<td>
				 <a href="/profile?id={{ prq.owner.key.id }}">{{prq.owner.user.email}}</a></td>
			</td>
			{% ifequal current_user ride.rideoffer.owner %} <!-- only show "assign seat" if user is owner --!>
				<td>
					 <a href="/ride?id={{ride.key.id}}&prq_id={{prq.key.id}}&action=APRV">Approve Request</a></td>
				</td>
			{% endifequal %}
		  </tr>
		{% endfor %}
		</table>

	</p>
	{% endifequal %}
	<p> <!-- Static Google Map -->
	<h3>Map</h3>
	<img src="http://maps.google.com/staticmap?&size=400x400&markers={{lat_lng_src}},reds%7C{{lat_lng_des}},blued&key={{key}}"/>
    </p>

{% endblock %}